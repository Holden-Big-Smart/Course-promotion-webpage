<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>屯門婦聯山景中心 - 課程宣傳</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        // 配置 Tailwind 颜色以支持动态类名
    </script>
    <style>
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* 书签文字竖排样式 */
        .vertical-text {
            writing-mode: vertical-lr;
            text-orientation: upright;
            letter-spacing: 2px;
            font-family: sans-serif;
        }

        /* 标签页过渡动画 - 核心修复 */
        .tab-content {
            display: none !important;
            /* 强制隐藏，防止 Tailwind 'grid' 类导致的占位问题 */
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .tab-content.active {
            display: flex !important;
            flex-direction: column;
            opacity: 1;
        }

        .pagination-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 2rem;
            gap: 1.5rem;
            /* 间距 */
            font-weight: bold;
            color: #4b5563;
            user-select: none;
        }

        .page-btn {
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: white;
            border: 1px solid #e5e7eb;
            transition: all 0.2s;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .page-btn:hover:not(.disabled) {
            background-color: #eff6ff;
            color: #2563eb;
            border-color: #bfdbfe;
            transform: scale(1.05);
        }

        .page-btn.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background-color: #f9fafb;
        }

        .page-info {
            min-width: 80px;
            text-align: center;
            font-variant-numeric: tabular-nums;
            font-size: 1rem;
        }
    </style>
</head>

<body class="bg-gray-50 flex flex-col min-h-screen">

    <!-- Navigation -->
    <%- include('../shared/header') %>

        <div class="relative bg-gray-900 h-64">
            <div class="absolute inset-0">
                <img class="w-full h-full object-cover opacity-60" src="/images/home_banner.webp" alt="Banner">
            </div>
            <div class="relative max-w-7xl mx-auto h-full flex flex-col justify-center items-center text-center px-4">
                <h1 class="text-4xl font-extrabold text-white sm:text-5xl drop-shadow-lg tracking-wider">
                    <%= __("hero_title") %>
                </h1>
                <p class="mt-6 text-xl max-w-3xl mx-auto drop-shadow-md text-gray-200">
                    <%= __("hero_subtitle") %>

                </p>
            </div>
        </div>

        <main class="flex-grow">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">

                <!-- 1. 热门课程轮播图 -->
                <div class="mb-16">
                    <h2 class="text-3xl font-bold tracking-tight text-gray-900 mb-6 flex items-center">
                        <span class="bg-red-600 w-2 h-8 mr-3 rounded-full"></span>
                        <%= __('section_hot') %>
                    </h2>

                    <!-- 修改点1：移除此处的 group 类，避免全局触发 -->
                    <div class="relative">
                        <!-- 轮播容器 -->
                        <div id="carousel-container"
                            class="flex overflow-x-auto gap-3 md:gap-6 scrollbar-hide scroll-smooth pb-4 px-1 snap-x py-4">
                            <% if (hotCourses.length===0) { %>
                                <div class="w-full text-center py-10 text-gray-400">
                                    <%= __('暂无热门课程') %>
                                </div>
                                <% } else { %>
                                    <% hotCourses.forEach(course=> {
                                        const colorKey = centerColors[course.center] || 'gray';
                                        const labelBg = `bg-${colorKey}-600`;
                                        const borderClass = `border-${colorKey}-600`;
                                        const status = getCourseStatus(course.startTime, course.endTime);
                                        %>
                                        <div
                                            class="flex-shrink-0 w-44 md:w-64 snap-start bg-white rounded-xl shadow-lg border-2 <%= borderClass %> overflow-hidden hover:shadow-2xl transition-all duration-300 relative flex flex-col">

                                            <!-- 【书签】右上角中心标签 -->
                                            <div
                                                class="absolute top-0 right-4 <%= labelBg %> text-white w-8 pt-3 pb-4 rounded-b-lg z-20 shadow-md flex justify-center">
                                                <span class="text-xs font-bold vertical-text leading-none">
                                                    <%= course.center %>
                                                </span>
                                            </div>

                                            <!-- 海报区域 -->
                                            <!-- 修改点2：使用具名组 group/hot 和 group-hover/hot 以隔离悬停效果 -->
                                            <div class="w-full bg-gray-50 relative group/hot cursor-pointer"
                                                onclick="window.location.href='/course/<%= course._id %>'">
                                                <img src="<%= course.image %>"
                                                    class="w-full h-auto object-contain transition duration-500 group-hover/hot:scale-105"
                                                    alt="<%= course.title %>">
                                            </div>

                                            <div class="p-4 bg-white flex flex-col flex-grow border-t border-gray-100">
                                                <!-- 标题 + 状态 -->
                                                <div class="mb-3">
                                                    <h3
                                                        class="text-sm md:text-lg font-bold text-gray-900 inline align-middle leading-snug hover:text-red-600 transition">
                                                        <a href="/course/<%= course._id %>">
                                                            <%= course.title %>
                                                        </a>
                                                    </h3>
                                                    <% if(status==='waiting' ) { %>
                                                        <span
                                                            class="inline-flex align-middle ml-2 px-2 py-0.5 bg-green-100 text-green-800 border border-green-200 text-xs font-bold rounded-md whitespace-nowrap animate-pulse">
                                                            <%= __('报名中') %>
                                                        </span>
                                                        <% } else if (status==='running' ) { %>
                                                            <span
                                                                class="inline-flex align-middle ml-2 px-2 py-0.5 bg-yellow-100 text-yellow-800 border border-yellow-200 text-xs font-bold rounded-md whitespace-nowrap">
                                                                <%= __('进行中') %>
                                                            </span>
                                                            <% } else { %>
                                                                <span
                                                                    class="inline-flex align-middle ml-2 px-2 py-0.5 bg-gray-100 text-gray-600 border border-gray-200 text-xs font-bold rounded-md whitespace-nowrap">
                                                                    <%= __('已结束') %>
                                                                </span>
                                                                <% } %>
                                                </div>

                                                <!-- 底部价格与按钮 -->
                                                <div class="flex justify-between items-center mt-auto">
                                                    <span class="text-red-600 font-bold text-base md:text-xl">HK$ <%=
                                                            course.price %>
                                                    </span>
                                                    <a href="/course/<%= course._id %>"
                                                        class="text-white bg-red-600 hover:bg-red-700 px-4 py-1.5 rounded-full text-sm font-medium transition shadow-sm">
                                                        <%= __('查看详情') %>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        <% }) %>
                                            <% } %>
                        </div>

                        <!-- 轮播控制按钮 -->
                        <button id="scroll-left"
                            class="absolute left-0 top-1/2 -translate-y-1/2 -ml-4 bg-white/90 p-3 rounded-full shadow-lg text-gray-800 hover:text-red-600 hover:scale-110 transition hidden md:block z-30">
                            <i class="fas fa-chevron-left text-xl"></i>
                        </button>
                        <button id="scroll-right"
                            class="absolute right-0 top-1/2 -translate-y-1/2 -mr-4 bg-white/90 p-3 rounded-full shadow-lg text-gray-800 hover:text-red-600 hover:scale-110 transition hidden md:block z-30">
                            <i class="fas fa-chevron-right text-xl"></i>
                        </button>
                    </div>
                </div>

                <!-- 2. 分类标签页板块 -->
                <div>
                    <div class="flex justify-center mb-10">
                        <div class="inline-flex bg-gray-200 rounded-full p-1 shadow-inner">
                            <button onclick="switchTab('interest')"
                                class="tab-btn px-2 py-2 rounded-full text-sm font-bold transition-all duration-300 text-gray-600 hover:text-gray-900 focus:outline-none active bg-white shadow text-blue-600"
                                data-target="interest">
                                <%= __('兴趣班组') %>
                            </button>
                            <button onclick="switchTab('prof')"
                                class="tab-btn px-2 py-2 rounded-full text-sm font-bold transition-all duration-300 text-gray-600 hover:text-gray-900 focus:outline-none"
                                data-target="prof">
                                <%= __('专业课程') %>
                            </button>
                            <button onclick="switchTab('activity')"
                                class="tab-btn px-2 py-2 rounded-full text-sm font-bold transition-all duration-300 text-gray-600 hover:text-gray-900 focus:outline-none"
                                data-target="activity">
                                <%= __('活动') %>
                            </button>
                            <button onclick="switchTab('erb')"
                                class="tab-btn px-2 py-2 rounded-full text-sm font-bold transition-all duration-300 text-gray-600 hover:text-gray-900 focus:outline-none"
                                data-target="erb">
                                <%= __('ERB再培训') %>
                            </button>
                            <button onclick="switchTab('other')"
                                class="tab-btn px-2 py-2 rounded-full text-sm font-bold transition-all duration-300 text-gray-600 hover:text-gray-900 focus:outline-none"
                                data-target="other">
                                <%= __('其他') %>
                            </button>
                        </div>
                    </div>

                    <div class="min-h-[400px]">
                        <% function renderCards(list) { if (list.length===0) { %>
                            <div
                                class="col-span-4 text-center py-20 text-gray-400 bg-gray-50 rounded-xl border border-dashed border-gray-200">
                                <i class="fas fa-folder-open text-4xl mb-3 block"></i>
                                <%= __('暂无相关课程') %>
                            </div>
                            <% } else { list.forEach(item=> {
                                const colorKey = centerColors[item.center] || 'gray';
                                const labelBg = `bg-${colorKey}-600`;
                                const borderClass = `border-${colorKey}-600`;
                                const status = getCourseStatus(item.startTime, item.endTime);
                                %>
                                <div
                                    class="group relative bg-white border-2 <%= borderClass %> rounded-lg overflow-hidden hover:shadow-xl transition-all duration-300 flex flex-col h-full">

                                    <!-- 【书签】右上角中心标签 (悬挂效果) -->
                                    <div
                                        class="absolute top-0 right-4 <%= labelBg %> text-white w-7 pt-2 pb-3 rounded-b-md z-20 shadow-md flex justify-center opacity-90 group-hover:opacity-100 transition">
                                        <span class="text-[10px] font-bold vertical-text leading-none tracking-widest">
                                            <%= item.center %>
                                        </span>
                                    </div>

                                    <!-- 海报区域 -->
                                    <div class="w-full bg-gray-50 relative overflow-hidden">
                                        <img src="<%= item.image %>" loading="lazy" alt="<%= item.title %>"
                                            class="w-full h-auto object-contain transition-transform duration-500 group-hover:scale-105">
                                        <!-- 全卡片点击链接 -->
                                        <a href="/course/<%= item._id %>" class="absolute inset-0 z-10"
                                            aria-label="查看详情"></a>
                                    </div>

                                    <div
                                        class="p-4 text-center flex flex-col flex-grow relative z-20 pointer-events-none">
                                        <!-- 标题区域 (pointer-events-auto 让链接可点) -->
                                        <div class="mb-2 pointer-events-auto">
                                            <h3
                                                class="text-sm font-bold text-gray-900 inline align-middle leading-snug hover:text-blue-600 transition">
                                                <a href="/course/<%= item._id %>">
                                                    <%= item.title %>
                                                </a>
                                            </h3>

                                            <!-- 【状态标签】紧跟标题右侧 -->
                                            <% if(status==='waiting' ) { %>
                                                <span
                                                    class="inline-flex align-middle ml-1.5 px-1.5 py-0.5 bg-green-100 text-green-800 border border-green-200 text-[10px] font-bold rounded whitespace-nowrap animate-pulse">
                                                    <%= __('报名中') %>
                                                </span>
                                                <% } else if (status==='running' ) { %>
                                                    <span
                                                        class="inline-flex align-middle ml-1.5 px-1.5 py-0.5 bg-yellow-100 text-yellow-800 border border-yellow-200 text-[10px] font-bold rounded whitespace-nowrap">
                                                        <%= __('进行中') %>
                                                    </span>
                                                    <% } else { %>
                                                        <span
                                                            class="inline-flex align-middle ml-1.5 px-1.5 py-0.5 bg-gray-100 text-gray-500 border border-gray-200 text-[10px] font-bold rounded whitespace-nowrap">
                                                            <%= __('已结束') %>
                                                        </span>
                                                        <% } %>
                                        </div>

                                        <div class="mt-auto pt-2 border-t border-gray-50">
                                            <p class="text-base font-bold text-red-600">HK$<%= item.price %>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <% }); } } %>

                                    <div id="tab-interest" class="tab-content active">
                                        <div
                                            class="course-grid grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-y-6 gap-x-3 items-start">
                                            <% renderCards(groupInterest) %>
                                        </div>
                                        <div class="pagination-container" data-id="tab-interest"></div>
                                    </div>

                                    <div id="tab-prof" class="tab-content">
                                        <div
                                            class="course-grid grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-y-6 gap-x-3 items-start">
                                            <% renderCards(groupProf) %>
                                        </div>
                                        <div class="pagination-container" data-id="tab-prof"></div>
                                    </div>

                                    <div id="tab-activity" class="tab-content">
                                        <div
                                            class="course-grid grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-y-6 gap-x-3 items-start">
                                            <% renderCards(groupActivity) %>
                                        </div>
                                        <div class="pagination-container" data-id="tab-activity"></div>
                                    </div>

                                    <div id="tab-erb" class="tab-content">
                                        <div
                                            class="course-grid grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-y-6 gap-x-3 items-start">
                                            <% renderCards(groupERB) %>
                                        </div>
                                        <div class="pagination-container" data-id="tab-erb"></div>
                                    </div>

                                    <div id="tab-other" class="tab-content">
                                        <div
                                            class="course-grid grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-y-6 gap-x-3 items-start">
                                            <% renderCards(groupOther) %>
                                        </div>
                                        <div class="pagination-container" data-id="tab-other"></div>
                                    </div>
                    </div>
                </div>

            </div>
        </main>

        <footer class="bg-white border-t border-gray-200 mt-auto">
            <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
                <p class="text-center text-base text-gray-400">&copy; <%= __('footer_rights') %>
                </p>
            </div>
        </footer>

        <script>
            const carousel = document.getElementById('carousel-container');
            const leftBtn = document.getElementById('scroll-left');
            const rightBtn = document.getElementById('scroll-right');

            if (leftBtn && carousel) {
                leftBtn.addEventListener('click', () => { carousel.scrollBy({ left: -350, behavior: 'smooth' }); });
                rightBtn.addEventListener('click', () => { carousel.scrollBy({ left: 350, behavior: 'smooth' }); });
            }

            function switchTab(targetName) {
                // 更新按钮状态
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    if (btn.dataset.target === targetName) {
                        btn.classList.add('bg-white', 'shadow', 'text-blue-600');
                        btn.classList.remove('text-gray-600', 'hover:text-gray-900');
                    } else {
                        btn.classList.remove('bg-white', 'shadow', 'text-blue-600');
                        btn.classList.add('text-gray-600', 'hover:text-gray-900');
                    }
                });

                const allTabs = document.querySelectorAll('.tab-content');
                const targetTab = document.getElementById('tab-' + targetName);

                // 1. 先将所有激活的 Tab 设为透明 (Fade Out)
                allTabs.forEach(tab => {
                    if (tab.classList.contains('active')) {
                        tab.style.opacity = '0';
                    }
                });

                // 2. 等待过渡结束后切换内容 (300ms 与 CSS transition 一致)
                setTimeout(() => {
                    // 隐藏所有
                    allTabs.forEach(tab => tab.classList.remove('active'));

                    // 显示目标并 Fade In
                    if (targetTab) {
                        targetTab.classList.add('active');
                        // 强制重绘以确保 opacity transition 生效
                        requestAnimationFrame(() => {
                            targetTab.style.opacity = '1';
                        });
                    }
                }, 300);
            }

            document.addEventListener('DOMContentLoaded', () => {
                const ITEMS_PER_PAGE = 8; // 每页显示数量

                // 初始化所有 Tab
                document.querySelectorAll('.tab-content').forEach(tab => {
                    initPagination(tab);
                });

                function initPagination(tabElement) {
                    const grid = tabElement.querySelector('.course-grid');
                    const paginationContainer = tabElement.querySelector('.pagination-container');

                    if (!grid || !paginationContainer) return;

                    // 获取该 Tab 下所有课程卡片
                    // 注意：renderCards 生成的可能是直接的 div 元素
                    const cards = Array.from(grid.children);
                    const totalItems = cards.length;

                    // 如果课程数量 <= 每页限制，不显示分页，但要确保显示所有卡片
                    if (totalItems <= ITEMS_PER_PAGE) return;

                    const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);
                    let currentPage = 1;

                    // 渲染分页 HTML (← 1 / 3 →)
                    paginationContainer.innerHTML = `
                <div class="pagination-wrapper">
                    <div class="page-btn prev-btn"><i class="fas fa-arrow-left"></i></div>
                    <span class="page-info">1 / ${totalPages}</span>
                    <div class="page-btn next-btn"><i class="fas fa-arrow-right"></i></div>
                </div>
            `;

                    const prevBtn = paginationContainer.querySelector('.prev-btn');
                    const nextBtn = paginationContainer.querySelector('.next-btn');
                    const pageInfo = paginationContainer.querySelector('.page-info');

                    // 更新显示状态的核心函数
                    function updateDisplay() {
                        const start = (currentPage - 1) * ITEMS_PER_PAGE;
                        const end = start + ITEMS_PER_PAGE;

                        // 遍历卡片，控制显隐
                        cards.forEach((card, index) => {
                            if (index >= start && index < end) {
                                card.classList.remove('hidden'); // 显示
                                card.style.display = ''; // 清除可能的内联样式
                            } else {
                                card.classList.add('hidden'); // 隐藏
                            }
                        });

                        // 更新页码文字
                        pageInfo.textContent = `${currentPage} / ${totalPages}`;

                        // 更新按钮状态
                        if (currentPage === 1) prevBtn.classList.add('disabled');
                        else prevBtn.classList.remove('disabled');

                        if (currentPage === totalPages) nextBtn.classList.add('disabled');
                        else nextBtn.classList.remove('disabled');
                    }

                    // 绑定点击事件
                    prevBtn.addEventListener('click', () => {
                        if (currentPage > 1) {
                            currentPage--;
                            updateDisplay();
                            // 可选：翻页后平滑滚动到列表顶部
                            // tabElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    });

                    nextBtn.addEventListener('click', () => {
                        if (currentPage < totalPages) {
                            currentPage++;
                            updateDisplay();
                            // tabElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    });

                    // 初始化第一次显示
                    updateDisplay();
                }
            });
        </script>
</body>

</html>